---
title: Fix WSL DNS issue on VPN
excerpt: Workaround to overcome the DNS issue when using VPN
categories:
  - development
tags:
  - WSL
  - Linux
  - DNS
---

{% include toc %}


1. Re-enble auto generation of resolv.conf (if disabled)
by commented the disable with #

```bash
sudo vi /etc/wsl.conf
```

```bash
#[network]
#generateResolvConf = false
```

2. Create the script

sudo vi vpn-dns.sh

```bash
#!/bin/bash

echo "Getting current DNS servers, this takes a couple of seconds"

/mnt/c/Windows/System32/WindowsPowerShell/v1.0/powershell.exe -Command '
$ErrorActionPreference="SilentlyContinue"
Get-NetAdapter -InterfaceDescription "Cisco AnyConnect*" | Get-DnsClientServerAddress | Select -ExpandProperty ServerAddresses
Get-NetAdapter | ?{-not ($_.InterfaceDescription -like "Cisco AnyConnect*") } | Get-DnsClientServerAddress | Select -ExpandProperty ServerAddresses
' | \
        awk 'BEGIN { print "# Generated by vpn fix func on", strftime("%c"); print } { print "nameserver", $1 }' | \
        tr -d '\r' | tee /etc/resolv.conf
```

3. Make it executable/run as sudo

```bash
sudo chmod +x vpn-dns.sh
```

4. Run as superuser

```bash
sudo vpn-dns.sh
```

5. Set interface metric in PowerShell

```PowerShell
Get-NetAdapter | Where-Object {$_.InterfaceDescription -Match "Cisco AnyConnect"} | Set-NetIPInterface -InterfaceMetric 6000
```

It can be restored:

```PowerShell
Get-NetAdapter | Where-Object {$_.InterfaceDescription -Match "Cisco AnyConnect"} | Set-NetIPInterface -InterfaceMetric 1
```



Source: https://stackoverflow.com/questions/66444822/wsl-2-dns-is-not-working-with-vpn-connection-on-win-10
